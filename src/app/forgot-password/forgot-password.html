<!-- 背景 -->
<div class="forgot-bg"></div>

<!-- 主容器 -->
<div class="forgot-container">
  <!-- 左侧品牌区域 -->
  <div class="forgot-brand">
    <div class="brand-content">
      <div class="brand-logo">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="48" height="48" fill="#1890ff" fill-opacity="0.1" />
          <path d="M12 12H22V22H12V12Z" fill="#1890ff" />
          <path d="M26 12H36V22H26V12Z" fill="#1890ff" fill-opacity="0.6" />
          <path d="M12 26H22V36H12V26Z" fill="#1890ff" fill-opacity="0.6" />
          <path d="M26 26H36V36H26V26Z" fill="#1890ff" fill-opacity="0.3" />
        </svg>
      </div>
      <h1 class="brand-title">Litho</h1>
      <p class="brand-tagline">企业级管理平台</p>
    </div>
  </div>

  <!-- 右侧表单区域 -->
  <div class="forgot-form-section">
    <div class="forgot-card">
      <!-- 步骤指示器 -->
      <div class="step-indicator">
        <div class="step" [class.active]="currentStep === 'request'" [class.completed]="currentStep !== 'request'">
          <div class="step-number">1</div>
          <span class="step-label">输入邮箱</span>
        </div>
        <div class="step-line" [class.active]="currentStep !== 'request'"></div>
        <div class="step" [class.active]="currentStep === 'verify'" [class.completed]="currentStep === 'reset' || currentStep === 'success'">
          <div class="step-number">2</div>
          <span class="step-label">验证身份</span>
        </div>
        <div class="step-line" [class.active]="currentStep === 'reset' || currentStep === 'success'"></div>
        <div class="step" [class.active]="currentStep === 'reset'" [class.completed]="currentStep === 'success'">
          <div class="step-number">3</div>
          <span class="step-label">重置密码</span>
        </div>
      </div>

      <!-- 步骤1: 输入邮箱 -->
      @if (currentStep === 'request') {
        <div class="forgot-header">
          <h2 class="forgot-title">忘记密码</h2>
          <p class="forgot-subtitle">请输入您的注册邮箱，我们将向您发送验证码</p>
        </div>

        <form nz-form nzLayout="vertical" [formGroup]="requestForm" (ngSubmit)="submitRequest()" class="forgot-form">
          <nz-form-item>
            <nz-form-label nzRequired>邮箱地址</nz-form-label>
            <nz-form-control nzErrorTip="请输入有效的电子邮箱地址">
              <nz-input-group nzPrefixIcon="mail">
                <input type="email" nz-input formControlName="email" placeholder="name@company.com" autocomplete="email" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item class="submit-item">
            <nz-form-control>
              <button nz-button nzType="primary" nzBlock [nzLoading]="loading" [disabled]="!requestForm.valid">
                发送验证码
              </button>
            </nz-form-control>
          </nz-form-item>
        </form>
      }

      <!-- 步骤2: 验证验证码 -->
      @if (currentStep === 'verify') {
        <div class="forgot-header">
          <h2 class="forgot-title">验证身份</h2>
          <p class="forgot-subtitle">验证码已发送至 <strong>{{ submittedEmail }}</strong></p>
        </div>

        <form nz-form nzLayout="vertical" [formGroup]="verifyForm" (ngSubmit)="submitVerify()" class="forgot-form">
          <nz-form-item>
            <nz-form-label nzRequired>验证码</nz-form-label>
            <nz-form-control nzErrorTip="请输入6位验证码">
              <nz-input-group nzPrefixIcon="safety">
                <input nz-input formControlName="code" placeholder="请输入6位验证码" maxlength="6" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>

          <div class="resend-tip">
            没有收到验证码？
            @if (countdown > 0) {
              <span class="countdown">{{ countdown }}s 后重新发送</span>
            } @else {
              <a class="resend-link" (click)="resendCode($event)">重新发送</a>
            }
          </div>

          <nz-form-item class="submit-item">
            <nz-form-control>
              <button nz-button nzType="primary" nzBlock [nzLoading]="loading" [disabled]="!verifyForm.valid">
                验证
              </button>
            </nz-form-control>
          </nz-form-item>
        </form>
      }

      <!-- 步骤3: 重置密码 -->
      @if (currentStep === 'reset') {
        <div class="forgot-header">
          <h2 class="forgot-title">设置新密码</h2>
          <p class="forgot-subtitle">请设置一个新密码，至少8个字符</p>
        </div>

        <form nz-form nzLayout="vertical" [formGroup]="resetForm" (ngSubmit)="submitReset()" class="forgot-form">
          <nz-form-item>
            <nz-form-label nzRequired>新密码</nz-form-label>
            <nz-form-control nzErrorTip="密码至少需要8个字符">
              <nz-input-group nzPrefixIcon="lock">
                <input type="password" nz-input formControlName="password" placeholder="请输入新密码" autocomplete="new-password" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label nzRequired>确认新密码</nz-form-label>
            <nz-form-control nzErrorTip="请再次输入新密码">
              <nz-input-group nzPrefixIcon="lock">
                <input type="password" nz-input formControlName="confirmPassword" placeholder="请再次输入新密码" autocomplete="new-password" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item class="submit-item">
            <nz-form-control>
              <button nz-button nzType="primary" nzBlock [nzLoading]="loading" [disabled]="!resetForm.valid">
                重置密码
              </button>
            </nz-form-control>
          </nz-form-item>
        </form>
      }

      <!-- 步骤4: 成功 -->
      @if (currentStep === 'success') {
        <div class="success-content">
          <div class="success-icon">
            <span nz-icon nzType="check-circle" nzTheme="fill"></span>
          </div>
          <h2 class="success-title">密码重置成功</h2>
          <p class="success-subtitle">您的密码已成功重置，请使用新密码登录</p>
          <button nz-button nzType="primary" nzBlock (click)="backToLogin()">
            返回登录
          </button>
        </div>
      }

      <!-- 返回链接 -->
      @if (currentStep !== 'success') {
        <div class="back-link-container">
          @if (currentStep === 'request') {
            <a class="back-link" (click)="backToLogin()">
              <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
              返回登录
            </a>
          } @else {
            <a class="back-link" (click)="goBack()">
              <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
              返回上一步
            </a>
          }
        </div>
      }
    </div>

    <!-- 版权信息 -->
    <div class="forgot-copyright">
      © 2026 Litho System. All rights reserved.
      <p>Design by Kain</p>
    </div>
  </div>
</div>

