<nz-layout style="height: 100%; background: transparent">
  <nz-page-header>
    <nz-page-header-title>授权项目</nz-page-header-title>
    <nz-page-header-tags>
      <nz-tag>{{ doc.topic }}</nz-tag>
    </nz-page-header-tags>
    <nz-page-header-extra>
      <nz-space nzAlign="center">
        <button
          *nzSpaceItem
          nz-button
          nzType="primary"
          nzShape="circle"
          nz-tooltip="同步"
          nz-popconfirm
          nzPopconfirmTitle="您确定要同步监控吗?"
          (nzOnConfirm)="sync()"
        >
          <span nz-icon nzType="sync" nzTheme="outline"></span>
        </button>
      </nz-space>
    </nz-page-header-extra>
  </nz-page-header>

  <nz-content style="overflow: hidden auto">
    <nz-card>
      <nz-table nzSize="middle" nzTemplateMode>
        <thead>
          <tr>
            <th nzLeft nzWidth="200px"><b>项目名称</b></th>
            <th><b>授权主题</b></th>
            <th nzRight nzWidth="80px"><b>消息流入</b></th>
            <th nzRight nzWidth="80px"><b>消息流出</b></th>
            <th nzRight nzWidth="80px"><b>消息废弃</b></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let id of doc.projects" (contextmenu)="openActions($event, actions, id)">
            <td>
              <ng-container *ngIf="projectDict[id] as project">
                {{ project.name }}
              </ng-container>
            </td>
            <td> {{ doc.topic }}/{{ id }} </td>
            <td>
              <ng-container *ngIf="metricsDict[doc.topic + '/' + id] as metric">
                {{ metric['messages.in.count'] | nzSafeNull }}
              </ng-container>
            </td>
            <td>
              <ng-container *ngIf="metricsDict[doc.topic + '/' + id] as metric">
                {{ metric['messages.out.count'] | nzSafeNull }}
              </ng-container>
            </td>
            <td>
              <ng-container *ngIf="metricsDict[doc.topic + '/' + id] as metric">
                {{ metric['messages.dropped.count'] | nzSafeNull }}
              </ng-container>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </nz-content>
</nz-layout>

<nz-dropdown-menu #actions="nzDropdownMenu">
  <ul *ngIf="actived as v" nz-menu>
    <li nz-menu-item nzDisabled>
      <b>{{ projectDict[v].name }}</b>
    </li>
    <li nz-menu-divider></li>
    <li nz-menu-item (click)="openPublish(v)"> 发布 </li>
  </ul>
</nz-dropdown-menu>
