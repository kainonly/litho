<ng-template #searchRef>
  <nz-row [nzGutter]="6">
    <nz-col>
      <nz-input-group style="width: 180px" nzSuffixIcon="search">
        <input
          (keyup.enter)="submitSearch()"
          [(ngModel)]="searchText"
          type="text"
          nz-input
          placeholder="搜索"
          i18n-placeholder
        />
      </nz-input-group>
    </nz-col>
    <nz-col>
      <nz-button-group>
        <button nz-button nzType="text" nz-tooltip="刷新" i18n-nz-tooltip (click)="getData(true)">
          <i nz-icon nzType="reload"></i>
        </button>
        <button nz-button nzType="text" nz-tooltip="重置" i18n-nz-tooltip (click)="clearSearch()">
          <i nz-icon nzType="clear"></i>
        </button>
      </nz-button-group>
    </nz-col>
  </nz-row>
</ng-template>

<ng-template #extraRef>
  <button nz-button nzType="primary" (click)="form()"> 新增 </button>
</ng-template>

<nz-card [nzTitle]="searchRef" [nzExtra]="extraRef">
  <nz-table
    #basicTable
    [nzFrontPagination]="false"
    [nzShowSizeChanger]="true"
    [nzHideOnSinglePage]="true"
    [nzLoading]="dataset.loading"
    [nzData]="dataset.values"
    [nzTotal]="dataset.total"
    [(nzPageSize)]="dataset.pagesize"
    [(nzPageIndex)]="dataset.page"
    (nzPageIndexChange)="getData(false)"
    (nzPageSizeChange)="getData(true)"
  >
    <thead>
      <tr>
        <th
          nzWidth="60px"
          nzLeft
          nzAlign="center"
          [nzChecked]="dataset.checked"
          [nzIndeterminate]="dataset.indeterminate"
          (nzCheckedChange)="dataset.setNChecked($event)"
        >
        </th>
        <th>
          <b i18n>项目名称 </b>
          <i nz-icon nzType="tag"></i>
        </th>
        <th>
          <b i18n>应用 ID</b>
        </th>
        <th><b i18n>状态</b></th>
        <th><b i18n>有效期</b></th>
        <th nzWidth="200px"><b i18n>创建时间</b></th>
        <th nzWidth="200px"><b i18n>更新时间</b></th>
        <th nzWidth="60px" nzRight nzAlign="center">
          <button nz-button nzType="text" nzBlock disabled>
            <i nz-icon nzType="setting"></i>
          </button>
        </th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let data of basicTable.data">
        <tr>
          <td
            nzLeft
            nzAlign="center"
            [nzDisabled]="data['disabled']"
            [nzChecked]="dataset.checkedIds.has(data['_id'])"
            (nzCheckedChange)="dataset.setChecked(data['_id'], $event)"
          >
          </td>
          <td>
            <a nz-tooltip="进入项目" [routerLink]="['/', data['namespace'], 'overview', 'cluster']">
              {{ data['name'] }}
            </a>
            <nz-tag>{{ data['namespace'] }}</nz-tag>
          </td>
          <td>
            <a nz-tooltip="查看" (click)="openAppKey()">{{ data['_id'] }}</a>
          </td>
          <td>
            <ng-container *ngIf="data['status']; else isFalse">
              <nz-badge nzStatus="processing"></nz-badge> 启用
            </ng-container>
            <ng-template #isFalse> <nz-badge nzStatus="default"></nz-badge> 关闭 </ng-template>
          </td>
          <td>
            <ng-container *ngIf="data['expire'] === 0; else hasExpire">永久</ng-container>
            <ng-template #hasExpire>
              {{ data['expire'] * 1000 | date: 'yyyy-MM-dd' }}
            </ng-template>
          </td>
          <td> {{ data['create_time'] | date: 'yyyy-MM-dd HH:mm:ss' }} </td>
          <td> {{ data['update_time'] | date: 'yyyy-MM-dd HH:mm:ss' }}</td>
          <td nzRight nzAlign="center">
            <button nz-button nzType="text" nz-dropdown [nzDropdownMenu]="menu">
              <i nz-icon nzType="ellipsis"></i>
            </button>
            <nz-dropdown-menu #menu="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item (click)="form(data)" i18n>编辑</li>
                <li nz-menu-item nzDanger (click)="delete(data)" i18n>删除</li>
              </ul>
            </nz-dropdown-menu>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </nz-table>
</nz-card>

<ng-template #unset>未设置</ng-template>

<!--<ng-template>-->
<!--  <nz-descriptions [nzColumn]="1">-->
<!--    <nz-descriptions-item nzTitle="密钥">-->
<!--      <ng-container *ngIf="data['secret']; else unset">-->
<!--        <span nz-typography nzCopyable [nzContent]="data['secret']"></span>-->
<!--      </ng-container>-->
<!--    </nz-descriptions-item>-->
<!--    <nz-descriptions-item nzTitle="白名单入口">-->
<!--      <ng-container *ngIf="data['entry'].length !== 0; else unset">-->
<!--        {{ data['entry'] }}-->
<!--      </ng-container>-->
<!--    </nz-descriptions-item>-->
<!--  </nz-descriptions>-->
<!--</ng-template>-->
