<nz-layout style="height: 100%; background: transparent">
  <nz-page-header>
    <nz-page-header-title>日志</nz-page-header-title>
    <nz-page-header-subtitle>{{ doc.schedule!.jobs[index].option.url }}</nz-page-header-subtitle>
    <nz-page-header-footer>
      <nz-row nzAlign="middle" nzJustify="space-between">
        <nz-col>
          <nz-space nzAlign="center">
            <nz-range-picker
              *nzSpaceItem
              style="width: 320px"
              [nzShowTime]="{ nzFormat: 'HH:mm' }"
              nzFormat="yyyy-MM-dd HH:mm"
              [(ngModel)]="timestamp"
              (ngModelChange)="getData(true)"
              nz-tooltip="建议范围不要超过一天"
            ></nz-range-picker>
            <wpx-toolbox *nzSpaceItem [wpxModel]="model" (wpxClear)="clear()" (wpxRefresh)="getData(true)">
            </wpx-toolbox>
          </nz-space>
        </nz-col>
        <nz-col></nz-col>
        <nz-col>
          <ng-container *ngIf="model.selection.size as size">
            <button nz-button nzType="dashed" nz-dropdown [nzDropdownMenu]="menu"> 已选中 {{ size }} 项 </button>
            <nz-dropdown-menu #menu="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item (click)="wpxTable.clearSelections()"> 取消选择 </li>
                <li nz-menu-item> 导出 </li>
              </ul>
            </nz-dropdown-menu>
          </ng-container>
        </nz-col>
      </nz-row>
    </nz-page-header-footer>
  </nz-page-header>

  <nz-content style="overflow: hidden auto">
    <wpx-table
      #wpxTable
      [wpxModel]="model"
      [wpxColumns]="[
        {
          title: '时间',
          key: 'timestamp',
          width: '200px',
          format: 'date'
        },
        {
          title: '响应结果',
          key: 'response',
          render: response,
          ellipsis: true
        }
      ]"
      [wpxItemSize]="50"
      wpxX="1600px"
      [wpxBodyStyle]="{ height: '100%' }"
      (wpxChange)="getData()"
    >
      <ng-template #response let-data>
        {{ data.response.status }}
        <nz-divider nzType="vertical"></nz-divider>
        <ng-container *ngIf="data.response.body; else noBodyRef">
          <a (click)="openResponse(data)">
            <code>{{ data.response.body }}</code>
          </a>
        </ng-container>
      </ng-template>
    </wpx-table>
  </nz-content>
</nz-layout>

<ng-template #noBodyRef>无返回结果</ng-template>
