<nz-page-header [nzGhost]="false">
  <nz-page-header-title>视频</nz-page-header-title>
  <nz-page-header-tags>
    <nz-select
      style="min-width: 180px"
      nzMode="multiple"
      nzPlaceHolder="筛选标签"
      nzAllowClear
      nzBorderless
      [(ngModel)]="tagIds"
      [nzServerSearch]="true"
      (nzOnSearch)="getTags($event)"
      (ngModelChange)="getData(true)"
    >
      <ng-container *ngFor="let item of tagItems">
        <nz-option [nzLabel]="item.name" [nzValue]="item._id"></nz-option>
      </ng-container>
    </nz-select>
  </nz-page-header-tags>
  <nz-page-header-extra>
    <nz-space>
      <ng-container *nzSpaceItem>
        <ng-container *ngTemplateOutlet="view.uploadRef"></ng-container>
      </ng-container>
      <ng-container *nzSpaceItem>
        <button
          nz-button
          nzType="primary"
          nzShape="circle"
          nz-tooltip="设置标签"
          i18n-nz-tooltip
          (click)="tagsRef.open()"
        >
          <i nz-icon nzType="tags"></i>
        </button>
        <wpx-tags #tagsRef [wpxApi]="tags" [wpxForm]="tagform" [wpxFormTemplate]="wpxFormTemplate">
          <ng-template #wpxFormTemplate>
            <ng-container [formGroup]="tagform">
              <nz-form-item>
                <nz-form-label nzRequired i18n>名称</nz-form-label>
                <nz-form-control
                  nzHasFeedback
                  [nzAutoTips]="{
                    default: {
                      required: '标签名称不能为空'
                    }
                  }"
                >
                  <input nz-input type="text" formControlName="name" placeholder="请填写标签名称" i18n-placeholder />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzRequired i18n>TID</nz-form-label>
                <nz-form-control>
                  <input nz-input type="text" formControlName="tid" readonly />
                </nz-form-control>
              </nz-form-item>
            </ng-container>
          </ng-template>
        </wpx-tags>
      </ng-container>
    </nz-space>
  </nz-page-header-extra>
  <nz-page-header-content>
    <nz-row nzJustify="space-between">
      <nz-col>
        <p nz-typography>
          <span nz-icon nzType="check-circle"></span>
          上传不超出 {{ (wpx.upload | async)?.limit | nzBytes : 0 : 'KB' }}，支持 mp4 文件类型的上传
        </p>
        <nz-space>
          <nz-input-group *nzSpaceItem style="width: 180px" nzSuffixIcon="search">
            <input
              (keyup.enter)="getData(true)"
              [(ngModel)]="searchText"
              type="text"
              nz-input
              placeholder="搜索"
              i18n-placeholder
            />
          </nz-input-group>
          <nz-button-group *nzSpaceItem>
            <button nz-button nzType="text" nz-tooltip="刷新" i18n-nz-tooltip (click)="getData(true)">
              <i nz-icon nzType="reload"></i>
            </button>
            <button nz-button nzType="text" nz-tooltip="重置" i18n-nz-tooltip (click)="clear()">
              <i nz-icon nzType="clear"></i>
            </button>
          </nz-button-group>
        </nz-space>
      </nz-col>
      <nz-col></nz-col>
      <nz-col>
        <nz-statistic *ngIf="view" [nzValue]="ds!.total" [nzTitle]="'元素数量'"></nz-statistic>
      </nz-col>
    </nz-row>
  </nz-page-header-content>
</nz-page-header>

<div style="padding: 6px; height: calc(100% - 116px)">
  <wpx-media-view
    #view
    [wpxData]="ds"
    [wpxType]="'videos'"
    [wpxFallback]="['assets', 'photon.svg'] | wpxAssets"
  ></wpx-media-view>
</div>

<ng-container *ngIf="ds.checkedNumber !== 0">
  <nz-alert class="actions" nzType="info" nzBanner nzMessage="批量" [nzDescription]="description" [nzAction]="bulk">
    <ng-template #description>
      已选中 <nz-tag>{{ ds.checkedNumber }}</nz-tag> 项
    </ng-template>
    <ng-template #bulk>
      <a nz-button nzType="link" nzSize="small" (click)="ds.clearChecked()">取消选择</a>
      <br />
      <a style="float: right" nz-button nzType="link" nzSize="small" nzDanger (click)="view.bulkDelete()">删除</a>
    </ng-template>
  </nz-alert>
</ng-container>
